jQuery(function(u){var f=u("form.cart"),i=u('input[name="payment_type"]'),d=u(".yith-wcdp-deposit-shipping"),r=d.find(".yith-wcdp-shipping-form"),h=null,n=function(){i.length?i.on("change",function(){var t=u(this),i=t.val();t.is(":checked")&&("deposit"===i?d.slideDown():d.slideUp())}).change():d.length&&d.slideDown()},m=function(t){d=f.find(".yith-wcdp-deposit-shipping"),i=u('input[name="payment_type"]'),d.length&&(n(),u.ajax({beforeSend:function(){d.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){d.unblock()},data:{product_id:t.variation_id,qty:f.find('input[name="quantity"]').val(),action:yith_wcdp.actions.calculate_shipping.name,nonce:yith_wcdp.actions.calculate_shipping.nonce},dataType:"json",method:"post",success:function(t){r.find("table").html(t.template)},url:yith_wcdp.ajax_url}))};f.on("found_variation",function(t,i){var n,a,c=u(this),e=c.find(".woocommerce-variation-add-to-cart"),o=c.find(".yith-wcdp-single-add-to-cart-fields"),d=o.find(".full-price"),r=o.find(".deposit-price"),p=o.data("deposit-type"),l=o.data("deposit-amount"),s=o.data("deposit-rate"),_=0;yith_wcdp.ajax_variations?h=u.ajax({beforeSend:function(){null!=h&&h.abort(),c.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){c.unblock()},data:{variation_id:i.variation_id,variation_attr:f.find(".variations select").serializeArray().reduce((t,i)=>(t[i.name]=i.value,t),{}),action:"get_deposit_template"},dataType:"html",success:function(t){o.length&&o.parent().remove(),e.before(t),o=c.find(".yith-wcdp-single-add-to-cart-fields"),m(i),u(document).trigger("yith_wcdp_updated_deposit_form",o)},url:yith_wcdp.ajax_url}):"undefined"!=typeof i.add_deposit_to_cart?(o.length&&o.parent().remove(),e.before(i.add_deposit_to_cart),m(i),u(document).trigger("yith_wcdp_updated_deposit_form",o)):o.length&&(n=i.display_price,a="( "+accounting.formatMoney(n,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",_="amount"===p?Math.min(n,l):(_=n*s/100,Math.min(n,_)),p="( "+accounting.formatMoney(_,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",d.html(a),r.html(p),m(i),u(document).trigger("yith_wcdp_updated_deposit_form",o))}).on("reset_data",function(){var t=u("#yith-wcdp-add-deposit-to-cart");t.parents(".variations_form").length&&yith_wcdp.variations_handling&&t.remove()}).on("click",".reset_variations",function(){u("#yith-wcdp-add-deposit-to-cart").hide()}).on("click",'#yith-wcdp-add-deposit-to-cart button[name="calc_shipping"]',function(t){t.preventDefault();var t=u(this),i=u("form.cart"),n=i.find('button[name="add-to-cart"]').val(),a=i.find('input[name="variation_id"]').val(),t=t.closest(".shipping-calculator-form"),c=t.find("#calc_shipping_country").val(),e=t.find("#calc_shipping_city").val(),o=t.find("#calc_shipping_state").val(),t=t.find("#calc_shipping_postcode").val();((n=n||a?n:i.find('input[name="add-to-cart"]').val())||a)&&u.ajax({beforeSend:function(){d.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){d.unblock()},data:{action:yith_wcdp.actions.change_location.name,nonce:yith_wcdp.actions.change_location.nonce,product_id:a||n,qty:i.find('input[name="quantity"]').val(),calc_shipping_country:c,calc_shipping_city:e,calc_shipping_state:o,calc_shipping_postcode:t},dataType:"json",method:"post",success:function(t){u(".shipping-calculator-form").slideUp("slow"),r.find("table").html(t.template),"undefined"!=typeof t.notices&&(d.prepend(u("<div>").addClass("yith-wcdp-messages").html(t.notices)).slideDown(),window.setTimeout(function(){u(".yith-wcdp-messages").slideUp("slow",function(){u(this).remove()})},3e3))},url:yith_wcdp.ajax_url})}).find("select:eq(0)").change(),u(document).on("yith_wcpb_ajax_update_price_request",function(t,i){var n=u(".yith-wcdp-single-add-to-cart-fields"),a=n.find(".full-price"),c=n.find(".deposit-price");n.length&&void 0!==i&&"undefined"!=typeof i.deposit_html&&(a.html("( "+i.price_html+" )"),c.html("( "+i.deposit_html+" )"))}),u(document).on("yith_wcevti_price_refreshed yith_wapo_product_price_updated yith_wcp_price_updated",function(t,i){var n=u(".yith-wcdp-single-add-to-cart-fields"),a=n.find(".full-price"),c=n.find(".deposit-price"),e=n.data("deposit-type"),o=n.data("deposit-amount"),d=n.data("deposit-rate"),r=0,p=u(".ywcp_wcp_group_total");!n.length||1===p.length&&"yith_wapo_product_price_updated"===t.type||(n="( "+accounting.formatMoney(i,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",r="amount"===e?Math.min(i,o):(r=i*d/100,Math.min(i,r)),p="( "+accounting.formatMoney(r,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",a.html(n),c.html(p))}),u(".shipping-calculator-form").hide(),n(),u(document).on("click",".shipping-calculator-button",function(){return u(".shipping-calculator-form").slideToggle("slow",function(){u("body").trigger("country_to_state_changed")}),!1})});